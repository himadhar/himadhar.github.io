---
layout: post
title: Unit Testing using TypeScript (TS)
date: 2017-12-11 12:34:55.000000000 +01:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- HTML
- JavaScript
- TypeScript
- Web Technologies
tags:
- jasmine
- karma
- karma-jasmine
- typescript
- typescript testing
- typescript unit testing
- unit testing
meta:
  _edit_last: '1'
  enable-sidebar: ''
  align-sidebar: right
  _thumbnail_id: '391'
author:
  login: Himadhar
  email: misterhimadhar@gmail.com
  display_name: Himadhar
  first_name: ''
  last_name: ''
permalink: "/karma-jasmine-unit-testing-of-typescript-ts/"
---
<style><!--<br />
body { color:#2d2d2d; font-family: "Segoe UI",helvetica,arial,sans-serif !important; } .tag-links { display:none; font-style: normal !important; } .entry-meta { display:none; } blockquote, q, .format-aside { font-style: normal !important; } html, body, div, span, applet, object, iframe, h1, h2, h3, h4, h5, h6, p, blockquote, pre, a, abbr, acronym, address, big, cite, code, del, dfn, em, font, ins, kbd, q, s, samp, small, strike, strong, sub, sup, tt, var, dl, dt, dd, ol, ul, li, fieldset, form, label, legend, table, caption, tbody, tfoot, thead, tr, th, td { font-family: "Segoe UI",helvetica,arial,sans-serif !important; } a:focus, a:active, a:hover { outline: none; } input[type="radio"], input[type="checkbox"] { box-sizing: border-box; padding: 0; margin-bottom: 10px; } .option_section { padding-bottom: 15px; margin-left: 15px; } .page_header { text-align: center; font-size: 150%; padding-top:5px; } .questions_list_container { padding-left:30px; padding-right:30px; } .question_container { border-bottom: 1px solid #eee; margin:2%; margin-top: 0; position: relative; } .question_container p { margin-left: 15px;margin-top: 10px; } .submit_button { 	height: 50px !important; 	position: absolute !important; 	width: 150px !important; 	left: 43% !important; 	margin-bottom: 15px !important; 	-moz-box-shadow: 0px 1px 0px 0px #f0f7fa !important; 	-webkit-box-shadow: 0px 1px 0px 0px #f0f7fa !important; 	box-shadow: 0px 1px 0px 0px #f0f7fa !important; 	background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #33bdef), color-stop(1, #019ad2)) !important; 	background:-moz-linear-gradient(top, #33bdef 5%, #019ad2 100%) !important; 	background:-webkit-linear-gradient(top, #33bdef 5%, #019ad2 100%) !important; 	background:-o-linear-gradient(top, #33bdef 5%, #019ad2 100%) !important; 	background:-ms-linear-gradient(top, #33bdef 5%, #019ad2 100%) !important; 	background:linear-gradient(to bottom, #33bdef 5%, #019ad2 100%) !important; 	filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#33bdef', endColorstr='#019ad2',GradientType=0) !important; 	background-color:#33bdef !important; 	-moz-border-radius:6px !important; 	-webkit-border-radius:6px !important; 	border-radius:6px !important; 	border:1px solid #057fd0 !important; 	display:inline-block !important; 	cursor:pointer !important; 	color:#ffffff !important; 	font-family:arial !important; 	font-size:15px !important; 	font-weight:bold !important; 	padding:6px 24px !important; 	text-decoration:none !important; 	text-shadow:0px -1px 0px #5b6178 !important; } .submit_button:hover { 	background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #019ad2), color-stop(1, #33bdef)) !important; 	background:-moz-linear-gradient(top, #019ad2 5%, #33bdef 100%) !important; 	background:-webkit-linear-gradient(top, #019ad2 5%, #33bdef 100%) !important; 	background:-o-linear-gradient(top, #019ad2 5%, #33bdef 100%) !important; 	background:-ms-linear-gradient(top, #019ad2 5%, #33bdef 100%) !important; 	background:linear-gradient(to bottom, #019ad2 5%, #33bdef 100%) !important; 	filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#019ad2', endColorstr='#33bdef',GradientType=0) !important; 	background-color:#019ad2 !important; } .submit_button:active { 	position:relative !important; 	top:1px !important; } img.status_icon { max-width: 50px; position:absolute; right: 0px; top: 50px; } #result_statement { color:#fff; background-color:#ff0000; margin-top: 0px; width: 70%; margin-left: 15%; margin-bottom: 10px; } #result_statement.all_valid { background-color: #1E961E; }<br />
--></style>
<p>I have been through multiple websites to find a solution to handle TypeScript unit testing and seems like using the Karma-Jasmine combination is a good start. With this post, I intend to summarize it and hope it helps you while doing so.</p>
<p>Below are a set of configurations you need to have to proceed.<!--more--></p>
<p><strong style="font-size: 1.2em;">package.json</strong></p>
<p>It requires certain items configured under it and the file should have basic components listed below: The scripts here allow us to perform actions like “npm test” which will handle the karma testing under it and so on.</p>
<pre><code>{
  "name": "UnitTestingTS",
  "version": "1.0.0",
  "private": true,
  "scripts": {
    "start": "tsc &amp;&amp; concurrently \"tsc -w\" \"lite-server\" ",
    "lite": "lite-server",
    "postinstall": "typings install",
    "test": "tsc &amp;&amp; concurrently \"tsc -w\" \"karma start scripts/karma.conf.js\"",
    "test-once": "tsc &amp;&amp; karma start scripts/karma.conf.js --single-run",
    "tsc": "tsc",
    "tsc:w": "tsc -w",
    "typings": "typings"
  },
  "dependencies": {
    "@types/jasmine": "^2.5.53",
    "jasmine": "^2.7.0",
    "jasmine-core": "~2.5.2",
    "karma": "^1.7.0",
    "karma-chrome-launcher": "^2.0.0",
    "karma-cli": "^1.0.1",
    "karma-jasmine": "^1.1.0",
    "karma-typescript": "^2.0.9",
    "requirejs": "^2.3.4"
  },
  "cordova": {
    "plugins": {
      "cordova-plugin-whitelist": {}
    }
  },
  "devDependencies": {
    "gulp": "3.9.1",
    "karma-sourcemap-loader": "^0.3.7",
    "karma-typescript-preprocessor": "^0.3.1",
    "requirejs": "^2.3.4",
    "typescript": "^2.4.2"
  }
}
</code></pre>
<p><strong style="font-size: 1.2em;">tsconfig.json</strong><br />
It is configured with 2 options in focus, the “module” set as “commonjs” and target to be “es5”, which will not use RequireJS while transpiling TS to JS files.</p>
<pre><code>
{
  "compileOnSave": true,
  "compilerOptions": {
    "module": "commonjs",
    "noImplicitAny": false,
    "noEmitOnError": true,
    "removeComments": false,
    "sourceMap": true,
    "inlineSources": true,
    "out": "../www/scripts/appBundle.js",
    "target": "es5"
  },
  "exclude": [
    "typings/cordova"
  ]
}
</code></pre>
<p><strong style="font-size: 1.2em;">karma.conf.js</strong><br />
This handles running the Jasmine Spec files and providing output with a debug-able HTML file to view reports. The main area of focus is the frameworks (jasmine – testing library, karma-typescript), plugins (pre-processor allows processing TS to JS before running the spec files), preprocessors (focus is on type &gt; TypeScript, and relevant configs), mime (allows the browser to not read the .ts files as video files and instead read as text), singleRun (should be set as false for continuous watch on file changes and update test logs w.r.t the same).</p>
<pre><code>
module.exports = function (config) {
    config.set({
        // base path that will be used to resolve all patterns (eg. files, exclude)
        basePath: '',
        frameworks: ['jasmine', "karma-typescript"],
        files: [
          '**/*.ts'
        ],
        exclude: [
            'typings/**/*.ts'
        ],
        plugins: [
            'karma-jasmine',
            'karma-chrome-launcher',
            'karma-typescript',
            'karma-typescript-preprocessor'
        ],
        preprocessors: {
            '**/*.ts': ['typescript']
        },

        typescriptPreprocessor: {
            // options passed to the typescript compiler
            options: {
                sourceMap: false, // (optional) Generates corresponding .map file.
                target: 'ES3', // (optional) Specify ECMAScript target version: 'ES3' (default), or 'ES5'
                module: 'commonjs', // (optional) Specify module code generation: 'commonjs' or 'amd'
                noImplicitAny: true, // (optional) Warn on expressions and declarations with an implied 'any' type.
                noResolve: true, // (optional) Skip resolution and preprocessing.
                removeComments: true, // (optional) Do not emit comments to output.
                concatenateOutput: false // (optional) Concatenate and emit output to single file. By default true if module option is omited, otherwise false.
            },
            // transforming the filenames
            transformPath: function (path) {
                return path.replace(/\.ts$/, '.js');
            }
        },

        mime: {
            'text/x-typescript': ['ts', 'tsx']
        },
        logLevel: config.LOG_INFO,
        reporters: ['progress', "karma-typescript"],
        port: 9876,
        colors: true,
        autoWatch: true,
        browsers: ['Chrome'],
        singleRun: false,
        concurrency: Infinity
    })
}
</code></pre>
<p><strong style="font-size: 1.2em;">code.ts</strong><br />
is a sample TS file with a simple function.</p>
<pre><code>function subtract(a: number, b: number): number {
  return a - b;
}
</code></pre>
<p><strong style="font-size: 1.2em;">test.ts</strong><br />
is a sample jasmine spec file written in TS, with 2 scenarios – one valid and other isn’t.</p>
<pre><code>
/// 
describe('subtract method', () =&gt; {
  it('subtracts 2 numbers', () =&gt; {
    expect(subtract(2, 4)).toBe(-3);
  });
  it('subtracts 2 numbers', () =&gt; {
    expect(subtract(2, 4)).toBe(-2);
  });
});
</code></pre>
<p><strong style="font-size: 1.2em;">Folder Structure</strong><br />
The folder structure for this example is as below, with the bundle (TS transpiled into JS) file being generated within the www folder:</p>
<p><a href="http://himadhar.com/wp-content/uploads/2017/12/1.png"><img class="alignnone size-full wp-image-364" style="height: auto; width: 50%;" src="{{ site.baseurl }}/assets/2017/12/1.png" alt="Folder structure." /></a></p>
<p><strong style="font-size: 1.2em;">Steps</strong><br />
Finally, the steps to run and execute the said test cases.<br />
<strong>Step 1: </strong>Perform a “npm install” with the console pointing to the path where package.json resides (root of the project tree).<br />
<strong>Step 2: </strong>Step 2: Once installed, type “karma start” in the console to view test results similar to below</p>
<p><a href="http://himadhar.com/wp-content/uploads/2017/12/2.png"><img class="alignnone size-full wp-image-366" style="height: auto; width: 100%;" src="{{ site.baseurl }}/assets/2017/12/2.png" alt="Console post npm install." /></a><br />
<em style="font-size: 0.9em; opacity: 0.8;">Note: You can also type “npm test” to achieve the same. The task is added in npm, within package.json under scripts’ options.</em></p>
<p>The setup is now complete. You can now proceed to add further classes and test methods, probably use "istanbul" plugin to generate reports. Feel free to reply below or email me and I'll try to respond as soon as possible.</p>
<p style="text-align: right;"><strong>- Himadhar</strong></p>
